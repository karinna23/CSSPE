{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="{% static 'img/selogo.png' %}">
    <link rel="stylesheet" href="{% static 'css/arnis_sheet.css' %}">
    <title>Contact Sheet</title>
</head>
<header>
    <div class="navbar">
    <div class="logo">
        <img src="{% static 'img/csspe.png' %}" alt="Logo">
    </div>
    <div class="nav-links">
        <ul>
            <li><a href="/sport">Sports</a></li>
            <li><a href="#">About Us</a></li>
        </ul>
    </div>
</div> 
<div class="sidebar">
    <h5>Scoring Board</h5>
    <hr class="bold-horizontal-line"> <!-- Apply a class to style the horizontal line -->
    <ul>
        <li><a href="/arnis_labanan">Arnis Labanan</a></li>
        <li><a href="/arnis_anyo">Anyo/Form</a></li>
    </ul>
    <h5>Full Contact Sheet</h5>
    <hr class="bold-horizontal-line"> <!-- Apply a class to style the horizontal line -->
    <ul>
        <li><a href="/labanan_sheet">Arnis Labanan</a></li>
        <li><a href="/anyo_sheet">Anyo/Form</a></li>
    </ul>
    <h5>Display</h5>
    <hr class="bold-horizontal-line"> <!-- Apply a class to style the horizontal line -->
    <ul>
        <li><a href="/labanan_display">Arnis Labanan</a></li>
        <li><a href="/anyo_display">Anyo/Form</a></li>
    </ul>
    <h5>History</h5>
    <hr class="bold-horizontal-line"> <!-- Apply a class to style the horizontal line -->
    <ul>
        <li><a href="/match_history">Match</a></li>
    </ul>
    <h5>Randomizer</h5>
    <hr class="bold-horizontal-line"> <!-- Apply a class to style the horizontal line -->
    <ul>
        <li><a href="/arnis_bracket">Create</a></li>
    </ul>
    <h5>Sport Data</h5>
    <hr class="bold-horizontal-line"> <!-- Apply a class to style the horizontal line -->
    <ul>
        <li><a href="/arnis_sport_data">Add Information</a></li>
    </ul>
    <h5>Logout</h5>
    <hr class="bold-horizontal-line"> <!-- Apply a class to style the horizontal line -->
    <ul>
        <li><a href="/logout">logout</a></li>
    </ul>
</div>
</header>
<body>
    <h1>Contact Sheet</h1>
    <div class="container">
        <form method="get" action="" class="year">
            <label for="school-year">School Year:</label>
            <select name="school_year" onchange="this.form.submit()" class="school-year">
                <option value="" >Select a School Year</option>
                {% for year in school_years %}
                    <option value="{{ year.YearID }}" {% if selected_year_id|stringformat:"s" == year.YearID|stringformat:"s" %}selected{% endif %}>
                        {{ year.start_year }}-{{ year.end_year }}
                    </option>
                {% endfor %}
            </select>
        </form>
        <form method="post">
            {% csrf_token %}
            <div class="form-section">
                <div class="match-info">
                <div class="columns">
                <div class="column">
                <label for="event">Event:</label>
                <input type="text" id="event" name="event">
                </div>
                <div class="column">
                <label for="venue">Venue:</label>
                <input type="text" id="venue" name="venue">
                </div>
                <div class="column">
                <label for="date">Date:</label>
                <input type="datetime-local" id="date" name="date">
                </div>
            </div>
            <div class="columns">
                <div class="column">
                    <label for="division">Division:</label>
                    <select id="division" name="division">
                        <option value="" >Select a Division</option>
                        <option value="mens">Men's</option>
                        <option value="womens">Women's</option>
                    </select>
                </div>
                
                <div class="column">
                    <label for="weight-category">Weight Category:</label>
                    <select id="weight-category" name="weight_category" class="input-fields">
                        <option value="" >Select a Weight Category</option>
                        <option value="pinweight">Pinweight</option>
                        <option value="bantamweight">Bantamweight</option>
                        <option value="featherweight">Featherweight</option>
                        <option value="extra_lightweight">Extra Lightweight</option>
                        <option value="half_lightweight">Half Lightweight</option>
                    </select>   
                </div>                
                <div class="column">
                <label for="match-no">Match No.:</label>
                <input type="text" id="match-no" name="match_no">
                </div>
            </div>

            <div class="columns">
                <div class="column">
                <label for="area">Area:</label>
                <input type="text" id="area" name="area">
                </div> 
                </div>
            </div> 
                <div class="player-info">
                <div class="team red-team">
                <h3>RED</h3>
                <div class="team-info">
                    <div class="team-block">
                        <label for="red-team-name">Team:</label>
                        <select id="red-team-name" name="red_team" class="team-block">
                            <option value="" >Select a Team</option>
                            {% for college in colleges %}
                                <option value="{{ college.collegeID }}">{{ college.college_abb }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="team-block">
                        <label for="red-player-name">Name:</label>
                        <select id="red-player-name" name="red_player" class="team-block">
                            <option value="" >Select a Player</option>
                            {% for player in players %}
                                <option value="{{ player.playerID }}">{{ player.player_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                </div>

                <div class="team blue-team">
                <div class="team-info">
                <div class="team-block">
                        <label for="blue-team-name">Team:</label>
                        <select id="blue-team-name" name="blue_team" class="team-block">
                            <option value="" >Select a Team</option>
                            {% for college in colleges %}
                                <option value="{{ college.collegeID }}">{{ college.college_abb }}</option>
                            {% endfor %}
                        </select>
                </div>
                    <div class="team-block">
                        <label for="blue-player-name">Name:</label>
                        <select id="blue-player-name" name="blue_player" class="team-block">
                            <option value="" >Select a Player</option>
                            {% for player in players %}
                                <option value="{{ player.playerID }}">{{ player.player_name }}</option>
                            {% endfor %}
                        </select>
                </div>                
                </div>
                <h3>BLUE</h3>
                </div>
                </div>     
                <hr class="bold-horizontal-line"> <!-- Apply a class to style the horizontal line -->
            <div class="round-section">
                <div class="round-title" id="round-1">Round 1</div>
                <hr class="bold-horizontal-line"> <!-- Apply a class to style the horizontal line -->
                <div class="team-section">
                    <div class="team-1">
                        <div class="metrics">
                            <div class="metric">Score: <span id="red-score" name="red_score1">0</span>
                            <input type="hidden" name="red_score1" value="0">
                            </div>
                            <div class="metric">Foul: <span id="red-foul" name="red_foul1">0</span>
                                <input type="hidden" name="red_foul1" value="0">
                            </div>
                            <div class="metric">Disarmed: <span id="red-disarmed" name="red_disarmed1">0</span>
                                <input type="hidden" name="red_disarmed1" value="0">
                            </div>
                            <div class="metric"><label>Total Score:</label>
                                <input type="text" id="red-total-score1" name="red_total_score1">
                            </div>                        
                        </div>
                    </div>
                    <div class="team-1">
                        <div class="metrics">
                            <div class="metric">Score: <span id="blue-score" name="blue_score1">0</span>
                                <input type="hidden" name="blue_score1" value="0">
                            </div>
                            <div class="metric">Foul: <span id= "blue-foul" name="blue_foul1">0</span>
                                <input type="hidden" name="blue_foul1" value="0">
                            </div>
                            <div class="metric">Disarmed: <span id="blue-disarmed" name="blue_disarmed1">0</span>
                                <input type="hidden" name="blue_disarmed1" value="0">
                            </div>
                            <div class="metric"><label>Total Score:</label>
                                <input type="text" id="blue-total-score1" name="blue_total_score1">
                            </div>                        
                        </div>
                    </div>
                </div>
                <div class="time-winner">
                        <div class="time">Time: <span id="time" name="time1">00:00</span>
                            <input type="hidden" name="time1" value="0:00">
                        </div>
                        <div class="winner">Winner: <span id="winner" name="winner1"></span>
                            <input type="hidden" name="winner1" value="n/A">
                        </div>
                </div>
                <div class="round-title" id="round-2">Round 2</div>
                <div class="team-section">
                    <div class="team-1">
                        <div class="metrics">
                            <div class="metric">Score: <span id="red-score" name="red_score2">0</span>
                                <input type="hidden" name="red_score2" value="0">
                            </div>
                            <div class="metric">Foul: <span id="red-foul" name="red_foul2">0</span>
                                <input type="hidden" name="red_foul2" value="0">
                            </div>
                            <div class="metric">Disarmed: <span id="red-disarmed" name="red_disarmed2">0</span>
                                <input type="hidden" name="red_disarmed2" value="0">
                            </div>
                            <div class="metric"><label>Total Score:</label>
                                <input type="text" id="red-total-score2" name="red_total_score2">
                            </div>   
                        </div>
                    </div>
                    <div class="team-1">
                        <div class="metrics">
                            <div class="metric">Score: <span id="blue-score" name="blue_score2">0</span>
                                <input type="hidden" name="blue_score2" value="0">
                            </div>
                            <div class="metric">Foul: <span id="blue-foul" name="blue_foul2">0</span>
                                <input type="hidden" name="blue_foul2" value="0">
                            </div>
                            <div class="metric">Disarmed: <span id="blue-disarmed" name="blue_disarmed2">0</span>
                                <input type="hidden" name="blue_disarmed2" value="0">
                            </div>
                            <div class="metric"><label>Total Score:</label>
                                <input type="text" id="blue-total-score2" name="blue_total_score2">
                            </div>   
                        </div>
                    </div>
                </div>
                <div class="time-winner">
                        <div class="time">Time: <span id="time" name="time2">00:00</span>
                            <input type="hidden" name="time2" value="0:00">
                    </div>
                        <div class="winner">Winner: <span id="winner" name="winner2"></span>
                            <input type="hidden" name="winner2" value="N/A">
                        </div>
                </div>
                <div class="round-title" id="round-3">Round 3</div>
                <div class="team-section">
                    <div class="team-1">
                        <div class="metrics">
                            <div class="metric">Score: <span id="red-score" name="red_score3">0</span>
                                <input type="hidden" name="red_score3" value="0">
                            </div>
                            <div class="metric">Foul: <span id="red-foul" name="red_foul3">0</span>
                                <input type="hidden" name="red_foul3" value="0">
                            </div>
                            <div class="metric">Disarmed: <span id="red-disarmed" name="red_disarmed3">0</span>
                                <input type="hidden" name="red_disarmed3" value="0">
                            </div>
                            <div class="metric"><label>Total Score:</label>
                                <input type="text" id="red-total-score3" name="red_total_score3">
                            </div>   
                        </div>
                    </div>
                    <div class="team-1">
                        <div class="metrics">
                            <div class="metric">Score: <span id="blue-score" name="blue_score3">0</span>
                                <input type="hidden" name="blue_score3" value="0">
                            </div>
                            <div class="metric">Foul: <span id="blue-foul" name="blue_foul3">0</span>
                                <input type="hidden" name="blue_foul3" value="0">
                            </div>
                            <div class="metric">Disarmed: <span id="blue-disarmed" name="blue_disarmed3">0</span>
                                <input type="hidden" name="blue_disarmed3" value="0">
                            </div>
                            <div class="metric"><label>Total Score:</label>
                                <input type="text" id="blue-total-score3" name="blue_total_score3">
                            </div>   
                        </div>
                    </div>
                </div>
                <div class="time-winner">
                        <div class="time">Time: <span id="time" name="time3">00:00</span>
                            <input type="hidden" name="time3" value="0:00">
                        </div>
                        <div class="winner">Winner: <span id="winner" name="winner3"></span>
                            <input type="hidden" name="winner3" value="N/A">
                        </div>
                </div>
            </div>
        </div>
            <div class="final-winner">
                <div><label>Winner:</label>
                    <input type="text" id="final_winner" name="final_winner">
                </div>
            </div>
            <div class="judge">
            <label for="judge1">Judge 1:</label>
            <select id="judge1" name="judge1">
                <option value="" >Select Judge 1</option>
                {% for judge in judges %}
                    <option value="{{ judge.judgeID }}">{{ judge.judge_name }}</option>
                {% endfor %}
            </select>
                
                <label for="judge2">Judge 2:</label>
                <select id="judge2" name="judge2">
                    <option value="" >Select Judge 2</option>
                    {% for judge in judges %}
                        <option value="{{ judge.judgeID }}">{{ judge.judge_name }}</option>
                    {% endfor %}
                </select>

                <label for="judge3">Judge 3:</label>
                <select id="judge3" name="judge3">
                    <option value="" >Select Judge 3</option>
                {% for judge in judges %}
                    <option value="{{ judge.judgeID }}">{{ judge.judge_name }}</option>
                {% endfor %}
            </select>            
        </div>
            <div class="other">
                <label for="referee">Referee:</label>
                <select id="referee" name="referee">
                    <option value="" >Select Referee</option>
                    {% for referee in referees %}
                        <option value="{{ referee.refereeID }}">{{ referee.referee_name }}</option>
                    {% endfor %}
                </select>
                
                <label for="recorder">Recorder:</label>
                <select id="recorder" name="recorder">
                    <option value="" >Select Recorder</option>
                    {% for recorder in recorders %}
                        <option value="{{ recorder.recorderID}}">{{ recorder.recorder_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn-save">Save Contact Sheet</button>
        </form>
    </div>
<script>document.addEventListener('DOMContentLoaded', function() {
        var playerSelects = document.querySelectorAll('select[name$="_player"]'); // Selects ending with '_player_name'        
        var judgeSelects = document.querySelectorAll('.judge select');
    
        function updateOptions(selects) {
            var selectedValues = Array.from(selects).map(select => select.value);
    
            selects.forEach(select => {
                var currentValue = select.value;
                Array.from(select.options).forEach(option => {
                    if (option.value && selectedValues.includes(option.value) && option.value !== currentValue) {
                        option.hidden = true; // Hide option if it's selected in another select
                    } else {
                        option.hidden = false; // Show option
                    }
                });
            });
        }
    
        judgeSelects.forEach(select => {
            select.addEventListener('change', () => updateOptions(judgeSelects));
        });
    
        playerSelects.forEach(select => {
            select.addEventListener('change', () => updateOptions(playerSelects));
        });
    });
    
    document.addEventListener('DOMContentLoaded', function() {
        // Dynamically load data for each round
        for (let roundNumber = 1; roundNumber <= 3; roundNumber++) {
            console.log(`Loading data for round ${roundNumber}`); // Debugging line
            loadRoundData(roundNumber.toString());
        }
    });
   
    
    function loadRoundData(roundNumber) {
        const roundData = JSON.parse(localStorage.getItem(`roundData${roundNumber}`));

        if (roundData) {
            // Update the UI with loaded data for Red Team
            const redScoreSpan = document.querySelector(`#red-score[name="red_score${roundNumber}"]`);
            const redFoulSpan = document.querySelector(`#red-foul[name="red_foul${roundNumber}"]`);
            const redDisarmedSpan = document.querySelector(`#red-disarmed[name="red_disarmed${roundNumber}"]`);
            
            redScoreSpan.textContent = roundData.redTeam.score;
            redFoulSpan.textContent = roundData.redTeam.foul;
            redDisarmedSpan.textContent = roundData.redTeam.disarmed;
    
            // Update hidden inputs for Red Team
            updateHiddenInput(`red_score${roundNumber}`, roundData.redTeam.score);
            updateHiddenInput(`red_foul${roundNumber}`, roundData.redTeam.foul);
            updateHiddenInput(`red_disarmed${roundNumber}`, roundData.redTeam.disarmed); 
            
            const timeSpan = document.querySelector(`#time[name="time${roundNumber}"]`);
            const winnerSpan = document.querySelector(`#winner[name="winner${roundNumber}"]`);
            
            timeSpan.textContent = roundData.time;
            winnerSpan.textContent = determineWinner(roundData);

            updateHiddenInput(`time${roundNumber}`, roundData.time);
            updateHiddenInput(`winner${roundNumber}`, determineWinner(roundData));
            // Update the UI with loaded data for Blue Team
            const blueScoreSpan = document.querySelector(`#blue-score[name="blue_score${roundNumber}"]`);
            const blueFoulSpan = document.querySelector(`#blue-foul[name="blue_foul${roundNumber}"]`);
            const blueDisarmedSpan = document.querySelector(`#blue-disarmed[name="blue_disarmed${roundNumber}"]`);
    
            blueScoreSpan.textContent = roundData.blueTeam.score;
            blueFoulSpan.textContent = roundData.blueTeam.foul;
            blueDisarmedSpan.textContent = roundData.blueTeam.disarmed;
    
            // Update hidden inputs for Blue Team
            updateHiddenInput(`blue_score${roundNumber}`, roundData.blueTeam.score);
            updateHiddenInput(`blue_foul${roundNumber}`, roundData.blueTeam.foul);
            updateHiddenInput(`blue_disarmed${roundNumber}`, roundData.blueTeam.disarmed);
    
            // Update Time and Winner
                      
        } else {
            console.log(`No data found for round ${roundNumber}`);
        }
    }
    
    function updateHiddenInput(inputName, value) {
        const hiddenInput = document.querySelector(`input[name="${inputName}"]`);
        if (hiddenInput) {
            hiddenInput.value = value;
        }
        else {
            console.error(`Hidden input not found: ${inputName}`);
        }
    }
    
    function determineWinner(roundData) {
        // Example logic based on scores
        const redScore = parseInt(roundData.redTeam.score, 10);
        const blueScore = parseInt(roundData.blueTeam.score, 10);
    
        if (redScore > blueScore) {
            return 'Red';
        } else if (blueScore > redScore) {
            return 'Blue';
        } else {
            return 'Draw'; // Or specific logic for draws or undecided outcomes
        }
    }    
    
    </script>    
</body>
</html>
