{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="{% static 'img/selogo.png' %}">
    <link rel="stylesheet" href="{% static 'css/arnis_sheet.css' %}">
    <title>LABANAN CONTACT SHEET</title>
</head>
<header>
    <div class="navbar">
    <div class="logo">
        <img src="{% static 'img/csspe.png' %}" alt="Logo">
    </div>
    <div class="nav-links">
        <ul>
            <li>
                <span>{{ username|upper  }}</span> <!-- Display Username -->
            </li>
            <li>
                <a href="/#">
                    <img src="{% static '/img/logout.png'%}"  alt="Match History" class="icon" placeholder="icon" /> <!-- Image as Icon -->
                    <span class="tooltip-text">Logout</span> <!-- Tooltip Text -->
                </a>
            </li>
        </ul>
    </div>
</div> 
<div class="sidebar">
    <h5>Scoring Board</h5>
    <hr class="bold-horizontal-line"> <!-- Apply a class to style the horizontal line -->
    <ul>
        <li><a href="/arnis_labanan">ARNIS LABANAN</a></li>
    </ul>
    <h5>Full Contact Sheet</h5>
    <hr class="bold-horizontal-line"> <!-- Apply a class to style the horizontal line -->
    <ul>
        <li><a href="/labanan_sheet">ARNIS LABANAN</a></li>
    </ul>
    <h5>Display</h5>
    <hr class="bold-horizontal-line"> <!-- Apply a class to style the horizontal line -->
    <ul>
        <li><a href="/labanan_display">ARNIS LABANAN</a></li>
    </ul>
</div>
</header>
<body>
    <h1>Contact Sheet</h1>
    <div class="container">
        <form method="post">
            {% csrf_token %} 
            <div class="form-section">
                <div class="match-info">
                <div class="columns">
                    <div class="column">
                        <label for="event">Event:</label><span id="event" name="event"></span>
                        <input type="hidden" name="event">
                    </div>
                <div class="column">
                <label for="venue">Venue:</label><span id="venue" name="venue"></span>
                <input type="hidden" name="venue">
                </div>
                <div class="column">
                <label for="date">Date:</label><span id="date" name="date"></span>
                <input type="hidden" name="date">
                </div>
            </div>
            <div class="columns">
                <div class="column">
                    <label for="division">Division:</label><span id="division" name="divison"></span>
                    <input type="hidden" name="division">
                </div>
                
                <div class="column">
                    <label for="weight-category">Weight Category:</label><span id="weight-category" name="weight_category"></span>
                    <input type="hidden" name="weight_category">
                </div>                
                <div class="column">
                <label for="match-no">Match No.:</label><span id="match-no" name="match_no"></span>
                <input type="hidden"  name="match_no">
                </div>
            </div>

            <div class="columns">
                <div class="column">
                <label for="area">Area:</label><span id="area" name="area"></span>
                <input type="hidden" name="area">
                </div> 
                <div class="column">
                    <label for="school-year">School Year:</label><span id="school-years" name="school_year"></span>
                    <input type="hidden" name="school_year" >
                </div>
                </div>
            </div> 
                <div class="player-info">
                <div class="team red-team">
                <h3>RED</h3>
                <div class="team-info">
                    <div class="team-block">
                        <label for="red-team-name">Team:</label><span id="red-team-name" name="red_team_name"></span>
                        <input type="hidden" name="red_team">
                    </div>
                    <div class="team-block">
                        <label for="red-player-name">Name:</label></label><span id="red-player-name" name="red_player_name"></span>
                        <input type="hidden" name="red_player">
                    </div>
                </div>
                </div>

                <div class="team blue-team">
                <div class="team-info">
                <div class="team-block">
                        <label for="blue-team-name">Team:</label><span id="blue-team-name" name="blue_team_name"></span>
                        <input type="hidden"  name="blue_team">
                </div>
                    <div class="team-block">
                        <label for="blue-player-name">Name:</label><span id="blue-player-name" name="blue_player_name"></span>
                        <input type="hidden" name="blue_player">
                </div>                
                </div>
                <h3>BLUE</h3>
                </div>
                </div>     
                <hr class="bold-horizontal-line"> <!-- Apply a class to style the horizontal line -->
            <div class="round-section">
                <div class="round-title" id="round-1">Round 1</div>
                <hr class="bold-horizontal-line"> <!-- Apply a class to style the horizontal line -->
                <div class="team-section">
                    <div class="team-1">
                        <div class="metrics">
                            <div class="metric">Score: <span id="red-score" name="red_score1">0</span>
                            <input type="hidden" name="red_score1" value="0">
                            </div>
                            <div class="metric">Foul: <span id="red-foul" name="red_foul1">0</span>
                                <input type="hidden" name="red_foul1" value="0">
                            </div>
                            <div class="metric">Disarmed: <span id="red-disarmed" name="red_disarmed1">0</span>
                                <input type="hidden" name="red_disarmed1" value="0">
                            </div>
                            <div class="metric"><label>Total Score:</label>
                                <input type="text" id="red-total-score1" name="red_total_score1" required>
                            </div>                        
                        </div>
                    </div>
                    <div class="team-1">
                        <div class="metrics">
                            <div class="metric">Score: <span id="blue-score" name="blue_score1">0</span>
                                <input type="hidden" name="blue_score1" value="0">
                            </div>
                            <div class="metric">Foul: <span id= "blue-foul" name="blue_foul1">0</span>
                                <input type="hidden" name="blue_foul1" value="0">
                            </div>
                            <div class="metric">Disarmed: <span id="blue-disarmed" name="blue_disarmed1">0</span>
                                <input type="hidden" name="blue_disarmed1" value="0">
                            </div>
                            <div class="metric"><label>Total Score:</label>
                                <input type="text" id="blue-total-score1" name="blue_total_score1" required>
                            </div>                        
                        </div>
                    </div>
                </div>
                <div class="time-winner">
                        <div class="time">Time: <span id="time" name="time1">00:00</span>
                            <input type="hidden" name="time1" value="0:00">
                        </div>
                        <div class="winner">Winner: <span id="winner" name="winner1"></span>
                            <input type="hidden" name="winner1" value="n/A">
                        </div>
                </div>
                <div class="round-title" id="round-2">Round 2</div>
                <div class="team-section">
                    <div class="team-1">
                        <div class="metrics">
                            <div class="metric">Score: <span id="red-score" name="red_score2">0</span>
                                <input type="hidden" name="red_score2" value="0">
                            </div>
                            <div class="metric">Foul: <span id="red-foul" name="red_foul2">0</span>
                                <input type="hidden" name="red_foul2" value="0">
                            </div>
                            <div class="metric">Disarmed: <span id="red-disarmed" name="red_disarmed2">0</span>
                                <input type="hidden" name="red_disarmed2" value="0">
                            </div>
                            <div class="metric"><label>Total Score:</label>
                                <input type="text" id="red-total-score2" name="red_total_score2" required>
                            </div>   
                        </div>
                    </div>
                    <div class="team-1">
                        <div class="metrics">
                            <div class="metric">Score: <span id="blue-score" name="blue_score2">0</span>
                                <input type="hidden" name="blue_score2" value="0">
                            </div>
                            <div class="metric">Foul: <span id="blue-foul" name="blue_foul2">0</span>
                                <input type="hidden" name="blue_foul2" value="0">
                            </div>
                            <div class="metric">Disarmed: <span id="blue-disarmed" name="blue_disarmed2">0</span>
                                <input type="hidden" name="blue_disarmed2" value="0">
                            </div>
                            <div class="metric"><label>Total Score:</label>
                                <input type="text" id="blue-total-score2" name="blue_total_score2" required>
                            </div>   
                        </div>
                    </div>
                </div>
                <div class="time-winner">
                        <div class="time">Time: <span id="time" name="time2">00:00</span>
                            <input type="hidden" name="time2" value="0:00">
                    </div>
                        <div class="winner">Winner: <span id="winner" name="winner2"></span>
                            <input type="hidden" name="winner2" value="N/A">
                        </div>
                </div>
                <div class="round-title" id="round-3">Round 3</div>
                <div class="team-section">
                    <div class="team-1">
                        <div class="metrics">
                            <div class="metric">Score: <span id="red-score" name="red_score3">0</span>
                                <input type="hidden" name="red_score3" value="0">
                            </div>
                            <div class="metric">Foul: <span id="red-foul" name="red_foul3">0</span>
                                <input type="hidden" name="red_foul3" value="0">
                            </div>
                            <div class="metric">Disarmed: <span id="red-disarmed" name="red_disarmed3">0</span>
                                <input type="hidden" name="red_disarmed3" value="0">
                            </div>
                            <div class="metric"><label>Total Score:</label>
                                <input type="text" id="red-total-score3" name="red_total_score3" required>
                            </div>   
                        </div>
                    </div>
                    <div class="team-1">
                        <div class="metrics">
                            <div class="metric">Score: <span id="blue-score" name="blue_score3">0</span>
                                <input type="hidden" name="blue_score3" value="0">
                            </div>
                            <div class="metric">Foul: <span id="blue-foul" name="blue_foul3">0</span>
                                <input type="hidden" name="blue_foul3" value="0">
                            </div>
                            <div class="metric">Disarmed: <span id="blue-disarmed" name="blue_disarmed3">0</span>
                                <input type="hidden" name="blue_disarmed3" value="0">
                            </div>
                            <div class="metric"><label>Total Score:</label>
                                <input type="text" id="blue-total-score3" name="blue_total_score3" required>
                            </div>   
                        </div>
                    </div>
                </div>
                <div class="time-winner">
                        <div class="time">Time: <span id="time" name="time3">00:00</span>
                            <input type="hidden" name="time3" value="0:00">
                        </div>
                        <div class="winner">Winner: <span id="winner" name="winner3"></span>
                            <input type="hidden" name="winner3" value="N/A">
                        </div>
                </div>
            </div>
        </div>
            <div class="final-winner">
                <div><label>Winner:</label>
                    <input type="text" id="final_winner" name="final_winner" required>
                </div>
            </div>
            <div class="judge">
            <label for="judge1">Judge 1:</label><span id="judge1" name="judge1"></span>
            <input type="hidden" name="judge1">
                
                <label for="judge2">Judge 2:</label><span id="judge2" name="judge2"></span>
                <input type="hidden" name="judge2">

                <label for="judge3">Judge 3:</label><span id="judge3" name="judge3"></span>
                <input type="hidden"name="judge3">
        </div>
            <div class="other">
                <label for="referee">Referee:</label><span id="referee" name="referee"></span>
                <input type="hidden"  name="referee">
                
                <label for="recorder">Recorder:</label><span id="recorder" name="recorder"></span>
                <input type="hidden" name="recorder">
            </div>
            <button type="submit" class="btn-save">Save Contact Sheet</button>
        </form>
    </div>
<script>document.addEventListener('DOMContentLoaded', function() {
        var playerSelects = document.querySelectorAll('select[name$="_player"]'); // Selects ending with '_player_name'        
        var judgeSelects = document.querySelectorAll('.judge select');
    
        function updateOptions(selects) {
            var selectedValues = Array.from(selects).map(select => select.value);
    
            selects.forEach(select => {
                var currentValue = select.value;
                Array.from(select.options).forEach(option => {
                    if (option.value && selectedValues.includes(option.value) && option.value !== currentValue) {
                        option.hidden = true; // Hide option if it's selected in another select
                    } else {
                        option.hidden = false; // Show option
                    }
                });
            });
        }
    
        judgeSelects.forEach(select => {
            select.addEventListener('change', () => updateOptions(judgeSelects));
        });
    
        playerSelects.forEach(select => {
            select.addEventListener('change', () => updateOptions(playerSelects));
        });
    });
    
    document.addEventListener('DOMContentLoaded', function() {
        // Dynamically load data for each round
        for (let roundNumber = 1; roundNumber <= 3; roundNumber++) {
            console.log(`Loading data for round ${roundNumber}`); // Debugging line
            loadRoundData(roundNumber.toString());
        }
    });
   
    
    function loadRoundData(roundNumber) {
        const roundData = JSON.parse(localStorage.getItem(`roundData${roundNumber}`));

        if (roundData) {
            // Update the UI with loaded data for Red Team
            const redScoreSpan = document.querySelector(`#red-score[name="red_score${roundNumber}"]`);
            const redFoulSpan = document.querySelector(`#red-foul[name="red_foul${roundNumber}"]`);
            const redDisarmedSpan = document.querySelector(`#red-disarmed[name="red_disarmed${roundNumber}"]`);
            
            redScoreSpan.textContent = roundData.redTeam.score;
            redFoulSpan.textContent = roundData.redTeam.foul;
            redDisarmedSpan.textContent = roundData.redTeam.disarmed;
    
            // Update hidden inputs for Red Team
            updateHiddenInput(`red_score${roundNumber}`, roundData.redTeam.score);
            updateHiddenInput(`red_foul${roundNumber}`, roundData.redTeam.foul);
            updateHiddenInput(`red_disarmed${roundNumber}`, roundData.redTeam.disarmed); 
            
            const timeSpan = document.querySelector(`#time[name="time${roundNumber}"]`);
            const winnerSpan = document.querySelector(`#winner[name="winner${roundNumber}"]`);
            
            timeSpan.textContent = roundData.time;
            winnerSpan.textContent = determineWinner(roundData);

            updateHiddenInput(`time${roundNumber}`, roundData.time);
            updateHiddenInput(`winner${roundNumber}`, determineWinner(roundData));
            // Update the UI with loaded data for Blue Team
            const blueScoreSpan = document.querySelector(`#blue-score[name="blue_score${roundNumber}"]`);
            const blueFoulSpan = document.querySelector(`#blue-foul[name="blue_foul${roundNumber}"]`);
            const blueDisarmedSpan = document.querySelector(`#blue-disarmed[name="blue_disarmed${roundNumber}"]`);
    
            blueScoreSpan.textContent = roundData.blueTeam.score;
            blueFoulSpan.textContent = roundData.blueTeam.foul;
            blueDisarmedSpan.textContent = roundData.blueTeam.disarmed;
    
            // Update hidden inputs for Blue Team
            updateHiddenInput(`blue_score${roundNumber}`, roundData.blueTeam.score);
            updateHiddenInput(`blue_foul${roundNumber}`, roundData.blueTeam.foul);
            updateHiddenInput(`blue_disarmed${roundNumber}`, roundData.blueTeam.disarmed);
    
            // Update Time and Winner
                      
        } else {
            console.log(`No data found for round ${roundNumber}`);
        }
    }
    
    function updateHiddenInput(inputName, value) {
        const hiddenInput = document.querySelector(`input[name="${inputName}"]`);
        if (hiddenInput) {
            hiddenInput.value = value;
        }
        else {
            console.error(`Hidden input not found: ${inputName}`);
        }
    }
    
    function determineWinner(roundData) {
        // Example logic based on scores
        const redScore = parseInt(roundData.redTeam.score, 10);
        const blueScore = parseInt(roundData.blueTeam.score, 10);
    
        if (redScore > blueScore) {
            return 'Red';
        } else if (blueScore > redScore) {
            return 'Blue';
        } else {
            return 'Draw'; // Or specific logic for draws or undecided outcomes
        }
    }  
    
    function updateLabanan() {
        // Retrieve the initial data from localStorage
        const labananData = JSON.parse(localStorage.getItem('labananData'));
    
        // Update UI with the latest data
        if (labananData) {
            // Update the visible elements
            document.getElementById('school-years').textContent = labananData.matchInfo.schoolYearText;
            document.getElementById('event').textContent = labananData.matchInfo.event;
            document.getElementById('venue').textContent = labananData.matchInfo.venue;
            document.getElementById('date').textContent = labananData.matchInfo.date;
            document.getElementById('division').textContent = labananData.matchInfo.divisionText;
            document.getElementById('weight-category').textContent = labananData.matchInfo.weightCategoryText;
            document.getElementById('match-no').textContent = labananData.matchInfo.matchNo;
            document.getElementById('area').textContent = labananData.matchInfo.area;
    
            document.getElementById('red-team-name').textContent = labananData.redTeam.nameText;
            document.getElementById('red-player-name').textContent = labananData.redTeam.playerText; 
            document.getElementById('blue-team-name').textContent = labananData.blueTeam.nameText; 
            document.getElementById('blue-player-name').textContent = labananData.blueTeam.playerText;
    
            document.getElementById('judge1').textContent = labananData.officials.judge1Text;
            document.getElementById('judge2').textContent = labananData.officials.judge2Text;
            document.getElementById('judge3').textContent = labananData.officials.judge3Text;
            document.getElementById('referee').textContent = labananData.officials.refereeText;
            document.getElementById('recorder').textContent = labananData.officials.recorderText;

            document.querySelector('input[name="school_year"]').value = labananData.matchInfo.schoolYear;
            document.querySelector('input[name="event"]').value = labananData.matchInfo.event;
            document.querySelector('input[name="venue"]').value = labananData.matchInfo.venue;
            document.querySelector('input[name="date"]').value = labananData.matchInfo.date;
            document.querySelector('input[name="division"]').value = labananData.matchInfo.division;
            document.querySelector('input[name="weight_category"]').value = labananData.matchInfo.weightCategory;
            document.querySelector('input[name="match_no"]').value = labananData.matchInfo.matchNo;
            document.querySelector('input[name="area"]').value = labananData.matchInfo.area;
            document.querySelector('input[name="red_team"]').value = labananData.redTeam.name;
            document.querySelector('input[name="red_player"]').value = labananData.redTeam.player; 
            document.querySelector('input[name="blue_team"]').value = labananData.blueTeam.name; 
            document.querySelector('input[name="blue_player"]').value = labananData.blueTeam.player;
            document.querySelector('input[name="judge1"]').value = labananData.officials.judge1;
            document.querySelector('input[name="judge2"]').value = labananData.officials.judge2;
            document.querySelector('input[name="judge3"]').value = labananData.officials.judge3;
            document.querySelector('input[name="referee"]').value = labananData.officials.referee;
            document.querySelector('input[name="recorder"]').value = labananData.officials.recorder;
        }
    }
    
    // Call the function to update UI initially and every second
    updateLabanan();
    setInterval(updateLabanan, 1000);    
    </script>    
</body>
</html>
